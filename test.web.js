/*! For license information please see test.web.js.LICENSE.txt */
(()=>{"use strict";var e={"../src/DBPF":e=>{e.exports=dbpf}},t={};function o(r){var n=t[r];if(void 0!==n)return n.exports;var s=t[r]={exports:{}};return e[r](s,s.exports,o),s.exports}var r={};(()=>{var e=r;Object.defineProperty(e,"__esModule",{value:!0});const t=o("../src/DBPF"),n=document.getElementById("toast");function s(e,t){const o=n.cloneNode(!0);if(o.removeAttribute("id"),o.textContent=e,t){const e=document.createElement("a");e.href=t,e.textContent="Goto",o.appendChild(e)}n.parentElement?.appendChild(o),setTimeout((()=>{o.style.visibility="visible",o.classList.add("show")}),100),setTimeout((()=>o.classList.remove("show")),2500),setTimeout((()=>o.remove()),3100)}const i=document.getElementById("input"),l=globalThis.files=[],a=globalThis.dbpfs=[],d=globalThis.entries=[],f=document.getElementById("output"),c={file:document.getElementById("file-template"),contents:document.getElementById("contents-template")};i?.addEventListener("change",(async function(e){for(;f.firstChild;)f.removeChild(f.firstChild);if(e.target.files.length){const o=e.target.files;l.push(...o);for(let e of o){const o=await t.DBPF.create(e);a.push(o);const r=c.file?.cloneNode(!0);r.removeAttribute("id"),r.removeAttribute("style");const n={};["filename","filepath","fileext","filesize","magic","dbpf-major","dbpf-minor","dbpf-usermajor","dbpf-userminor","dbpf-created","dbpf-modified","index-major","index-minor","index-count","index-size","index-offset","index-first","trash-count","trash-size","trash-offset","mode-flag","header-segments","dbpf-contents"].forEach((e=>n[e]=r.querySelector(`.${e}`))),n.filename.textContent=o.filename,n.filename.id=o.filename,n.filepath.textContent=o.filepath,n.filesize.textContent=`${o.filesize} bytes`,n.fileext.textContent=o.extension;const i=o.magic,l=`0x${i.toString(16).padStart(8,"0").toUpperCase()} (=${i})`;n.magic.textContent=l,f?.appendChild(r);const p=o.header.dbpf.major,y=`0x${p.toString(16).padStart(8,"0").toUpperCase()} (=${p})`,g=o.header.dbpf.minor,m=`0x${g.toString(16).padStart(8,"0").toUpperCase()} (=${g})`,x=o.header.dbpf.usermajor,u=`0x${x.toString(16).padStart(8,"0").toUpperCase()} (=${x})`,h=o.header.dbpf.userminor,b=`0x${h.toString(16).padStart(8,"0").toUpperCase()} (=${h})`,S=o.header.dbpf.created,C=`0x${S.toString(16).padStart(8,"0").toUpperCase()} (=${S}) (${new Date(S).toLocaleString()})`,$=o.header.dbpf.modified,z=`0x${$.toString(16).padStart(8,"0").toUpperCase()} (=${$}) (${new Date($).toLocaleString()})`;n["dbpf-major"].textContent=y,0===p?(n["dbpf-major"].style.color="grey",n["dbpf-major"].style.fontStyle="italic"):n["dbpf-major"].style.fontWeight="bold",n["dbpf-minor"].textContent=m,0===g?(n["dbpf-minor"].style.color="grey",n["dbpf-minor"].style.fontStyle="italic"):n["dbpf-minor"].style.fontWeight="bold",n["dbpf-usermajor"].textContent=u,0===x?(n["dbpf-usermajor"].style.color="grey",n["dbpf-usermajor"].style.fontStyle="italic"):n["dbpf-usermajor"].style.fontWeight="bold",n["dbpf-userminor"].textContent=b,0===h?(n["dbpf-userminor"].style.color="grey",n["dbpf-userminor"].style.fontStyle="italic"):n["dbpf-userminor"].style.fontWeight="bold",n["dbpf-created"].textContent=C,0===S?(n["dbpf-created"].style.color="grey",n["dbpf-created"].style.fontStyle="italic"):n["dbpf-created"].style.fontWeight="bold",n["dbpf-modified"].textContent=z,0===$?(n["dbpf-modified"].style.color="grey",n["dbpf-modified"].style.fontStyle="italic"):n["dbpf-modified"].style.fontWeight="bold";const U=o.header.index.major,W=`0x${U.toString(16).padStart(8,"0").toUpperCase()} (=${U})`,j=o.header.index.minor,v=`0x${j.toString(16).padStart(8,"0").toUpperCase()} (=${j})`,E=o.header.index.count,B=`0x${E.toString(16).padStart(8,"0").toUpperCase()} (=${E})`,T=o.header.index.size,A=`0x${T.toString(16).padStart(8,"0").toUpperCase()} (=${T})`,w=o.header.index.offset,I=`0x${w.toString(16).padStart(8,"0").toUpperCase()} (=${w})`,D=o.header.index.first,L=`0x${D.toString(16).padStart(8,"0").toUpperCase()} (=${D})`;n["index-major"].textContent=W,0===U?(n["index-major"].style.color="grey",n["index-major"].style.fontStyle="italic"):n["index-major"].style.fontWeight="bold",n["index-minor"].textContent=v,0===j?(n["index-minor"].style.color="grey",n["index-minor"].style.fontStyle="italic"):n["index-minor"].style.fontWeight="bold",n["index-count"].textContent=B,0===E?(n["index-count"].style.color="grey",n["index-count"].style.fontStyle="italic"):n["index-count"].style.fontWeight="bold",n["index-size"].textContent=A,0===T?(n["index-size"].style.color="grey",n["index-size"].style.fontStyle="italic"):n["index-size"].style.fontWeight="bold",n["index-offset"].textContent=I,0===w?(n["index-offset"].style.color="grey",n["index-offset"].style.fontStyle="italic"):n["index-offset"].style.fontWeight="bold",n["index-first"].textContent=L,0===D?(n["index-first"].style.color="grey",n["index-first"].style.fontStyle="italic"):n["index-first"].style.fontWeight="bold";const P=o.header.trash.count,F=`0x${P.toString(16).padStart(8,"0").toUpperCase()} (=${P})`,N=o.header.trash.size,q=`0x${N.toString(16).padStart(8,"0").toUpperCase()} (=${N})`,_=o.header.trash.offset,k=`0x${_.toString(16).padStart(8,"0").toUpperCase()} (=${_})`;n["trash-count"].textContent=F,0===P?(n["trash-count"].style.color="grey",n["trash-count"].style.fontStyle="italic"):n["trash-count"].style.fontWeight="bold",n["trash-size"].textContent=q,0===N?(n["trash-size"].style.color="grey",n["trash-size"].style.fontStyle="italic"):n["trash-size"].style.fontWeight="bold",n["trash-offset"].textContent=k,0===_?(n["trash-offset"].style.color="grey",n["trash-offset"].style.fontStyle="italic"):n["trash-offset"].style.fontWeight="bold";const G=`0x${o.table.mode.toString(16).padStart(8,"0").toUpperCase()} (=${o.table.mode})`,M=o.table.headerSegments.map((e=>e.toString())).join(", ");n["mode-flag"].textContent=G,0===o.table.mode?(n["mode-flag"].style.color="grey",n["mode-flag"].style.fontStyle="italic"):n["mode-flag"].style.fontWeight="bold",n["header-segments"].textContent=M,0===o.table.headerSegments.length?(n["header-segments"].style.color="grey",n["header-segments"].style.fontStyle="italic"):n["header-segments"].style.fontWeight="bold";let O=!1;const R=Array.from(o.table.keys());console.log(R.length,"entries found"),s(`${R.length} entries found in ${o.filename}`,`#${o.filename}`);for(let e of R){const t=await o.table.get(e);d.push(t);const r=c.contents?.cloneNode(!0);r.removeAttribute("id"),r.removeAttribute("style");const s={};["resource-index","resource-group","resource-type","resource-instance","resource-offset","resource-size-compressed","resource-size-memory","resource-size-file"].forEach((e=>s[e]=r.querySelector(`.${e}`))),s["resource-index"].textContent=e.toString();const i=t.group,l=`0x${i.toString(16).padStart(8,"0").toUpperCase()} (=${i})`,a=t.type,f=`0x${a.toString(16).padStart(8,"0").toUpperCase()} (=${a})`,p=t.instance,y=`0x${p.toString(16).padStart(16,"0").toUpperCase()} (=${p})`,g=t.offset,m=`0x${g.toString(16).padStart(8,"0").toUpperCase()} (=${g})`,x=t.size.flag,u=`0x${x.toString(16).padStart(8,"0").toUpperCase()} (=${x})`,h=t.size.memory,b=`0x${h.toString(16).padStart(8,"0").toUpperCase()} (=${h})`,S=t.size.file,C=`RAW: 0x${S.toString(16).padStart(8,"0").toUpperCase()}, S4PE: 0x${(2147483647&S).toString(16).padStart(8,"0").toUpperCase()} (=${2147483647&S})`;s["resource-group"].textContent=l,0===i?(s["resource-group"].style.color="grey",s["resource-group"].style.fontStyle="italic"):s["resource-group"].style.fontWeight="bold",s["resource-type"].textContent=f,0===a?(s["resource-type"].style.color="grey",s["resource-type"].style.fontStyle="italic"):s["resource-type"].style.fontWeight="bold",s["resource-instance"].textContent=y,p===BigInt(0)?(s["resource-instance"].style.color="grey",s["resource-instance"].style.fontStyle="italic"):s["resource-instance"].style.fontWeight="bold",s["resource-offset"].textContent=m,0===g?(s["resource-offset"].style.color="grey",s["resource-offset"].style.fontStyle="italic"):s["resource-offset"].style.fontWeight="bold",s["resource-size-compressed"].textContent=u,0===x?(s["resource-size-compressed"].style.color="grey",s["resource-size-compressed"].style.fontStyle="italic"):s["resource-size-compressed"].style.fontWeight="bold",s["resource-size-memory"].textContent=b,0===h?(s["resource-size-memory"].style.color="grey",s["resource-size-memory"].style.fontStyle="italic"):s["resource-size-memory"].style.fontWeight="bold",s["resource-size-file"].textContent=C,0===S?(s["resource-size-file"].style.color="grey",s["resource-size-file"].style.fontStyle="italic"):s["resource-size-file"].style.fontWeight="bold",O||(n["dbpf-contents"].innerText="",O=!0),n["dbpf-contents"]?.appendChild(r)}s(`${R.length} entries loaded from ${o.filename}`,`#${o.filename}`)}}console.log(e.target.files.length,"files added. Total:",l.length),i.value=""}))})()})();